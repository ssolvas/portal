<!DOCTYPE html>
<html xml:lang="ca-ES" lang="ca-ES" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<title>Canigó. Com configurar propiedades en fitxers YAML per a proves unitaries a Canigó</title>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
	<link href="/css/master.min.css" rel="stylesheet" type="text/css" />
	<link href="/css/canigo.css" rel="stylesheet" type="text/css" />
	<script src="/js/jquery.min.js" type="text/javascript"></script>

	<script>
		document.write("<meta name=\"titol\" content=\"Canigó. Com configurar propiedades en fitxers YAML per a proves unitaries a Canigó\" />");
		document.write("<meta name=\"description\" content=\"Com configurar propiedades en fitxers YAML per a proves unitaries per a projectes amb Canigó\" />");
	</script>

	

</head>
<body class="single">
	<div class="contenidor unfixed">

				

		<header class="fons_header navbar navbar-default z-index-menu">
			<div class="container" role="menu">
				<div class="row clearfix menuNav">
					<div class="col-md-3 col-xs-3 column visible-xs coloca ">
						<button type="button" onclick="amunt();" title="Menu"
							class="navbar-toggle pull-left" data-toggle="collapse"
							data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
					</div>

					<div class="col-md-3 col-xs-6 col-offset-2 column visible-xs titol-mobil">
						
						<span class="white titol-mobil-destacat">canigo.ctti</span><span class="white">.gencat.cat</span>
					</div>

					<div class="col-md-3 col-xs-3 column visible-xs coloca1">
						<button onclick="amunt();" type="button" title="Cerca"
							class="ico_cerca " data-toggle="collapse" data-target=".dos">
						</button>
					</div>

				</div>

				<div class="collapse dos">
					<div class="shadowBox">
						<form class="navbar-form navbar-left primer" action="/cercador/" method="get"
 						onsubmit="location.href=this.action+'?q='+this.cerca_cap.value; return false;">
							<div class="form-group">
								<input type="search" class="form-control" name="q" id="cerca_cap"
									title="Cerca"
									placeholder="Cerca" />
								<button type="button" title="Neteja" class="btn btn-default"></button>
								<input type="submit" class="ocult" name="Cerca" value="Cerca" />
							</div>
						</form>
					</div>
				</div>	

				<nav class="collapse navbar-collapse navbar-ex1-collapse ">
				
					<div class="row">
						<div class="col-md-6 col-sm-4 column">
							<a class="img-responsive logo" title="Generalitat de Catalunya"
								href="https://ctti.gencat.cat/">gencat.cat</a>
							<button class="menu_tancar visible-xs collapsed"
								data-target=".navbar-collapse" data-toggle="collapse"
								title="Tancar"></button>
						</div>

						<div class="col-md-6 col-sm-8 column hidden-xs hidden-mg">
							<form class="navbar-form cercador_vermell hidden-xs pull-right" action="/cercador/"  method="get" onsubmit="location.href=this.action+'?q='+this.cerca2.value; return false;">
								<div class="form-group">
									<label class="hidden" for="cerca2">Cerca</label>
									<input id="cerca2" class="form-control" type="search" 
									placeholder="Cerca" name="q" title="Cerca">
									<input class="btn btn-default" type="submit" title="Cerca" value="">
								</div>
							</form>

							

						</div>

					</div>
					<div class="col-xs-12 hidden-xs" id="nomPortal">
                    	<span class="titol-cap-nou">Centre de Telecomunicacions i Tecnologies de la Informació</span>
                    </div>					
					<ul class="nav navbar-nav">

			        	

						<li>
							<a class="dropdown-toggle" href='/' data-toggle='_dropdown'>Inici</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/arqctti' data-toggle='_dropdown'>Arquitectura CTTI</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/blog' data-toggle='_dropdown'>Blog</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cloud' data-toggle='_dropdown'>Cloud</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/canigo' data-toggle='_dropdown'>Canigó</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sic' data-toggle='_dropdown'>SIC</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sgde' data-toggle='_dropdown'>SGDE</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/gicar' data-toggle='_dropdown'>GICAR</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cs' data-toggle='_dropdown'>Centres de Suport</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/dadesref' data-toggle='_dropdown'>Gestió Tècnica de Dades</a>
						</li>

						

					</ul>

				</nav>
			</div>
		</header>



	</div>

	<section class="border-start">

						
			

			<article class="bgGrey">
				<div class="container">
					<div class="row">
						<div class="capcelera_basica col-sm-12">
							<div class="capcelera_basica_cont">
								<ol class="breadcrumb filariana hidden-xs">
									<li>
										<a href="/">Inici</a>
									</li>
									<li class="breadcrumbs2">
									
										<a href="/drafts">
											




























										</a>
										




























































































									
									</li>

								</ol>

								<h1 class="capcelera_flotant pull-left" data-txt=".title">
									

										
											




	Canigó. Com configurar propiedades en fitxers YAML per a proves unitaries a Canigó


										

									
								</h1>

								

								
								

								

								

							</div>
						</div>

					</div>
				</div>
			</article>

			


		   <div class="padding-xs container">
	    	
	    	   <i><b>Darrera actualització:</b></i> 26-10-2021
	        
           </div>
           
			<article class="padding-xs padding-sm padding-md contingut">				
				<div class="container">
 		
					
				

	


					

						

<h2 id="introducció">Introducció</h2>

<p>A partir de la versió 3.4.0 del Framework Canigó, la configuració es pot definir en format YAML, en lloc del tradicional format de propietats. En el cas de ser necesari sobrescriure propietats per a proves unitaries, és possible generar un fitxer YAML, ubicar-lo a la carpeta de recursos de prova i referenciar el seu contingut dins de qualsevol prova.</p>

<p>L&rsquo;objectiu d&rsquo;aquest article és mostrar com configurar propietats en fitxers YAML per a proves unitaries dins d&rsquo;un projecte generat amb el framework Canigó</p>

<h2 id="configuració">Configuració</h2>

<p>Per agregar un fitxer de propietats en format YAML en un projecte amb Canigó, es requereixen els següents canvis:</p>

<ul>
<li>Es necessita crear un fitxer <code>application.yml</code> a la carpeta <code>src/test/resources/config/props</code>, per exemple:</li>
</ul>

<pre><code class="language-yaml">application:
  id: YmlFileTestCanigo
  version: 1.0.0
  defaultLanguage: ca_ES

persistence:
  showSQL: true
  generateDdl: false
  database: HSQL
  dialect: org.hibernate.dialect.HSQLDialect
</code></pre>

<ul>
<li>Utilitzant les propietats, per exemple, al fitxer <code>app-custom-persistence-jpa.xml</code> de la carpeta <code>src/test/resources/config/spring</code>:</li>
</ul>

<pre><code class="language-xml">&lt;bean id=&quot;jpaVendorAdapter&quot; class=&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;&gt;
  &lt;description&gt; Fem servir Hibernate com a motor de persistència per sota de JPA. &lt;/description&gt;
  &lt;property name=&quot;showSql&quot; value=&quot;${persistence.showSQL}&quot; /&gt;
  &lt;property name=&quot;generateDdl&quot; value=&quot;${persistence.generateDdl}&quot; /&gt;
  &lt;property name=&quot;database&quot; value=&quot;${persistence.database}&quot; /&gt;
  &lt;property name=&quot;databasePlatform&quot; value=&quot;${persistence.dialect}&quot; /&gt;
&lt;/bean&gt;
</code></pre>

<h2 id="ús">Ús</h2>

<p>Per a poder fer ús de les propietats en YAML a les proves unitàries, serà necessari utilitzar el <code>YamlPropertiesApplicationContextInitializer</code>, per això serà necessari definir una classe per la carga de la configuració de Spring pel <code>ContextConfiguration</code>, per exemple, <code>TestAppConfig.java</code>:</p>

<pre><code class="language-java">...

@Configuration
@ImportResource({ &quot;classpath:spring/canigo-core.xml&quot; })
@ComponentScan(basePackages = { &quot;cat.gencat.ymlfiletestcanigo.service&quot; })
@EnableAutoConfiguration
public class TestAppConfig {

}
</code></pre>

<p>En el nostre test utilitzarem <code>TestAppConfig</code> per carregar la configuració de Spring i el <code>YamlPropertiesApplicationContextInitializer</code> per carregar les propietats en els fitxers YAML, per exemple podriem tenir el test <code>EquipamentServiceTest.java</code></p>

<pre><code class="language-java">...

@RunWith(SpringRunner.class)
@ContextConfiguration(classes = { TestAppConfig.class }, initializers = YamlPropertiesApplicationContextInitializer.class)
@FixMethodOrder(MethodSorters.NAME_ASCENDING)
public class EquipamentServiceTest {

  @Value(&quot;${application.id}&quot;)
  private String aplicationId;

  ...

	@Test
  public void testYamlProperties() throws IOException {
    Assert.assertEquals(&quot;YmlFileTestCanigo&quot;, aplicationId);

    Resource resource = YamlPropertiesUtils.getYamlPropertiesResource();
    Optional&lt;?&gt; applicationYaml = new YamlPropertySourceLoader()
      .load(resource.getFilename(), resource)
      .stream().map(propertySource -&gt; propertySource.getSource()).findFirst();

    Assert.assertTrue(applicationYaml.isPresent());
  }

  ...
}
</code></pre>

<h3 id="proves">Proves</h3>

<p>Si executem el test <code>EquipamentServiceTest.testYamlProperties</code>, podrem obtenir un resultat com:</p>

<p><img src="/images/howtos/2021-01-16_spring_yaml_test_example1.gif" alt="Spring Yaml Test Ejemplo 1" /></p>

<h2 id="conclusió">Conclusió</h2>

<ul>
<li>A Canigó és possibile sobreescriure les propietats de l&rsquo;aplicació a través de fitxers YAML que només afectin a les proves unitàries.</li>
</ul>

<h2 id="més-informació">Més informació</h2>

<p>Per a més informació podeu consultar la documentació del <a href="/canigo-documentacio-versions-34-core/modul-configuracio/">Mòdul de configuració</a> de Canigó</p>


					

					
				</div>	

			</article>	


	</section>	

		<div class="fons_footer ">
		<footer class="container center-block shadowBox2">
			<div class="shadow2"></div>
			<div class="row footer_tab_ord">

				<div class="footer_tab_bot col-sm-12">
					<div class="avis_legal">

						<div id="fAvisLegal">
							<div>
								<div class="hidden-xs">
									<a href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" alt="www.gencat.cat"
										/></a>
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								<div class="visible-xs avis_legal">
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								
								<div class="fi_peu visible-xs">
									<a title="www.gencat.cat" href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" 
										alt="www.gencat.cat" /></a> <a class="torna_amunt pull-right"
										href=" javascript:tornarAmunt();" title="Torna amunt">
										<p>Torna amunt</p>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

<script src="/js/master.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/custom.js" type="text/javascript"></script>



<script type="text/javascript">

if(location.hostname!=="localhost"){

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', "UA-59408075-1", 'auto');
	ga('send', 'pageview', {
	  	'page': location.pathname + location.search  + location.hash
	  }
	);

}

</script>




</body>
</html>
