<!DOCTYPE html>
<html xml:lang="ca-ES" lang="ca-ES" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<title>4.- Aplicació Microsoft integrada amb GICAR via ADFS</title>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
	<link href="/css/master.min.css" rel="stylesheet" type="text/css" />
	<link href="/css/canigo.css" rel="stylesheet" type="text/css" />
	<script src="/js/jquery.min.js" type="text/javascript"></script>

	<script>
		document.write("<meta name=\"titol\" content=\"4.- Aplicació Microsoft integrada amb GICAR via ADFS\" />");
		document.write("<meta name=\"description\" content=\"\" />");
	</script>

	

</head>
<body class="single">
	<div class="contenidor unfixed">

				

		<header class="fons_header navbar navbar-default z-index-menu">
			<div class="container" role="menu">
				<div class="row clearfix menuNav">
					<div class="col-md-3 col-xs-3 column visible-xs coloca ">
						<button type="button" onclick="amunt();" title="Menu"
							class="navbar-toggle pull-left" data-toggle="collapse"
							data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
					</div>

					<div class="col-md-3 col-xs-6 col-offset-2 column visible-xs titol-mobil">
						
						<span class="white titol-mobil-destacat">canigo.ctti</span><span class="white">.gencat.cat</span>
					</div>

					<div class="col-md-3 col-xs-3 column visible-xs coloca1">
						<button onclick="amunt();" type="button" title="Cerca"
							class="ico_cerca " data-toggle="collapse" data-target=".dos">
						</button>
					</div>

				</div>

				<div class="collapse dos">
					<div class="shadowBox">
						<form class="navbar-form navbar-left primer" action="/cercador/" method="get"
 						onsubmit="location.href=this.action+'?q='+this.cerca_cap.value; return false;">
							<div class="form-group">
								<input type="search" class="form-control" name="q" id="cerca_cap"
									title="Cerca"
									placeholder="Cerca" />
								<button type="button" title="Neteja" class="btn btn-default"></button>
								<input type="submit" class="ocult" name="Cerca" value="Cerca" />
							</div>
						</form>
					</div>
				</div>	

				<nav class="collapse navbar-collapse navbar-ex1-collapse ">
				
					<div class="row">
						<div class="col-md-6 col-sm-4 column">
							<a class="img-responsive logo" title="Generalitat de Catalunya"
								href="https://ctti.gencat.cat/">gencat.cat</a>
							<button class="menu_tancar visible-xs collapsed"
								data-target=".navbar-collapse" data-toggle="collapse"
								title="Tancar"></button>
						</div>

						<div class="col-md-6 col-sm-8 column hidden-xs hidden-mg">
							<form class="navbar-form cercador_vermell hidden-xs pull-right" action="/cercador/"  method="get" onsubmit="location.href=this.action+'?q='+this.cerca2.value; return false;">
								<div class="form-group">
									<label class="hidden" for="cerca2">Cerca</label>
									<input id="cerca2" class="form-control" type="search" 
									placeholder="Cerca" name="q" title="Cerca">
									<input class="btn btn-default" type="submit" title="Cerca" value="">
								</div>
							</form>

							

						</div>

					</div>
					<div class="col-xs-12 hidden-xs" id="nomPortal">
                    	<span class="titol-cap-nou">Centre de Telecomunicacions i Tecnologies de la Informació</span>
                    </div>					
					<ul class="nav navbar-nav">

			        	

						<li>
							<a class="dropdown-toggle" href='/' data-toggle='_dropdown'>Inici</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/arqctti' data-toggle='_dropdown'>Arquitectura CTTI</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/blog' data-toggle='_dropdown'>Blog</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cloud' data-toggle='_dropdown'>Cloud</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/canigo' data-toggle='_dropdown'>Canigó</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sic' data-toggle='_dropdown'>SIC</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sgde' data-toggle='_dropdown'>SGDE</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/gicar' data-toggle='_dropdown'>GICAR</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cs' data-toggle='_dropdown'>Centres de Suport</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/dadesref' data-toggle='_dropdown'>Gestió Tècnica de Dades</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/eventhub' data-toggle='_dropdown'>EventHub</a>
						</li>

						

					</ul>

				</nav>
			</div>
		</header>



	</div>

	<section class="border-start">

						
			

			<article class="bgGrey">
				<div class="container">
					<div class="row">
						<div class="capcelera_basica col-sm-12">
							<div class="capcelera_basica_cont">
								<ol class="breadcrumb filariana hidden-xs">
									<li>
										<a href="/">Inici</a>
									</li>
									<li class="breadcrumbs2">
									
										<a href="/gicar-novesintegracions-tecniques-autenticacio">
											




























										</a>
										
























































































	<a href="/gicar/">GICAR</a> </li>

	<li>
		<a href="/gicar-novesintegracions/">Modalitats d'integració possibles</a>
	</li>

	<li>
	
		<a href="/gicar-novesintegracions-tecniques-autenticacio/">
	

	Possibilitats tècniques d'integració

	
		</a>
	






									
									</li>

								</ol>

								<h1 class="capcelera_flotant pull-left" data-txt=".title">
									

										
											




	4.- Aplicació Microsoft integrada amb GICAR via ADFS


										

									
								</h1>

								

								
								

								

								

							</div>
						</div>

					</div>
				</div>
			</article>

			


		   <div class="padding-xs container">
	    	
	    	   <i><b>Darrera actualització:</b></i> 16-08-2018
	        
           </div>
           
			<article class="padding-xs padding-sm padding-md contingut">				
				<div class="container">
 		
					
				

	

	<div class="row" id="TOC">
		<div class="col-md-12 col-xs-12"> 
			<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#configuració-de-l-adfs-per-autenticar-contra-gicar">Configuració de l&rsquo;ADFS per autenticar contra GICAR:</a></li>
<li><a href="#configuració-sharepoint">CONFIGURACIÓ SHAREPOINT</a></li>
</ul></li>
</ul>
</nav>
    	</div>
	</div>

	


					

						

<p>Aquesta documentació defineix les especificacions tècniques per a la integració de la federació d’identitats de GICAR implantat sobre el producte Shibboleth per accedir a aplicacions desenvolupades en tecnologies Microsoft mitjançant ADFS (Active Directory Federation Services) de Microsoft.</p>

<p>En aquest tutorial s&rsquo;explica exactament com integrar un Sharepoint amb aquesta tipologia d&rsquo;integració.</p>

<p>A continuació es presenta la vista global del sistema:</p>

<p><img src="/related/gicar/saml-ShibAdfsShp.png" alt="Integració amb GICAR" /></p>

<p>La seqüència es la següent:</p>

<ol>
<li><p>El client amb el seu navegador intenta accedir a una aplicació web desplegada sobre Sharepoint.</p></li>

<li><p>Sharepoint detecta que el recurs està protegit i redirigeix l’usuari cap a AD FS.</p></li>

<li><p>El servei AD FS presenta a l’usuari la pàgina WAYF (Where Are you From) per a que l’usuari indiqui on es vol autenticar (actualment aquesta pàgina no es presenta ja que només es pot autenticar amb GICAR).</p></li>

<li><p>El navegador del client es redirigeix cap a l’Identity Provider de GICAR (Shibboleth) e inicia una transacció d’autenticació sota el protocol SAML 2.0.</p></li>

<li><p>Se li presenta al client el formulari de captura de credencials de GICAR.</p></li>

<li><p>Es validen les credencials.</p></li>

<li><p>L’Identity Provider genera un token en format SAML 2.0 amb la informació de l’usuari autentica i redirigeix l’usuari cap a l’ADFS.</p></li>

<li><p>L’ADFS verifica el token rebut i modifica la informació per adaptar-la a la que necessita Sharepoint i finalment deixa passar l’usuari cap a Sharepoint amb aquesta informació. Sharepoint presentarà l’aplicació web sol·licitada en el punt 1.</p></li>
</ol>

<h2 id="configuració-de-l-adfs-per-autenticar-contra-gicar">Configuració de l&rsquo;ADFS per autenticar contra GICAR:</h2>

<p><strong>Importar el certificat a la màquina de l&rsquo;ADFS</strong></p>

<p>A la màquina on es trobat instal·lat el servei ADFS realitzar els següents passos:</p>

<ul>
<li>Demanar a la OTGICAR el certificat del Idnetity Provider de GICAR i copiar-lo a la màquina de l&rsquo;ADFS.</li>
<li>A la màquina del ADFS, en la finestra Certificate, a la pestanya General, clicar a  Install Certificate per iniciar el Certificate Import Wizard.</li>
<li>Clicar sobre el botó  Next.</li>
<li>A la finestra Certificate Store, clicar sobre la opció Place all certificates in the following store.</li>
<li>Clicar sobre el botó Browse, i llavors clicar sobre el botó Show physical stores.</li>
<li>Sobre la carpeta Trusted Root Certificate Authorities, seleccionar Local Computer, i llavors clicar sobre el botó OK.</li>
<li>Clicar sobre el botó Next, Finish, OK i finalment sobre el botó OK.</li>
</ul>

<p><strong>Afegir Identity Provider (Shibboleth) com un Claim Provider</strong></p>

<p>Fent servir PowerShell s’afegeix l’Identity Provider a ADFS, obrint  una consola de comandes i executant les següents comandes Powershell:</p>

<pre><code>Add-PSSnapIn Microsoft.Adfs.PowerShell

Add-ADFSClaimsProviderTrust -Name &quot;Shibboleth IdP&quot; –MetadataFile https://idp-gicar.gencat.cat/idp/profile/Metadata/SAML

Set-ADFSClaimsProviderTrust –TargetName &quot;Shibboleth IdP&quot; –SignatureAlgorithm http://www.w3.org/2000/09/xmldsig#rsa-sha1
</code></pre>

<p>En cas que l’ADFS no tingui sortida a Internet, l’arxiu metadata del Shibboleth es pot copiar en una ruta local dins del servidor on està hostatjat l’ADFS. En aquest cas, en la primera sentència anterior s’ha de canviar el path del “MetadataFile” per la ruta local del servidor.</p>

<p>Per altra banda, i també fent servir PowerShell, s’han d’executar les següents comandes per tal de que l’ADFS no comprovi la validesa dels certificats contra CatCert (ja que, si no hi ha sortida cap Internet, el sistema no funcionarà).</p>

<pre><code>Add-PSSnapIn Microsoft.Adfs.PowerShell

Set-AdfsClaimsProviderTrust –TargetName “Shibboleth IdP” –SigningCertificateRevocationCheck “None”
Set-AdfsClaimsProviderTrust –TargetName “Shibboleth IdP” –EncryptionCertificateRevocationCheck “None”

Set-AdfsRelyingPartyTrust –TargetName “Sharepoint” –SigningCertificateRevocationCheck “None”
</code></pre>

<p><strong>Afegir Claim rules per a Identity Provider</strong></p>

<p>Les Claim Rules defineixen com els atributs rebuts en el token SAML 2.0 generat per l’Identity Provider es transformen en atributs de ADFS.</p>

<p>Cal seguir els següents passos:
- Obrir la consola de gestió de ADFS. En el menú Start, clicar sobre Administrative tools, i llavors clicar sobre AD FS Management.
- Després que el snap-in es carrega, clicar al node Trust Relationships, i llavors seleccionar Claims Provider Trusts.
- En el panell central de AD FS Management, fer click amb el botò dret Shibboleth IdP, i llavors fer click sobre Edit Claim Rules.
- A la pestanya Acceptance Transform Rules, clicar sobre el botó Add Rule.
- A la plana Select Rule Template, seleccionar Send Claims Using a Custom Rule, i llavors pitjar sobre el botó Next.
- A la plana Configure Rule, dintre de la capsa Claim rule name, escriure “Transform mail to E-Mail Address”.
- A la finestra Custom Rule, escriure o copiar/enganxar el següent text:</p>

<pre><code>c:[Type == &quot;urn:oid:0.9.2342.19200300.100.1.3&quot;]
 =&gt; issue(Type = &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;, Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, Value = c.Value, ValueType = c.ValueType);
</code></pre>

<ul>
<li>Fer click sobre el botó Finish.</li>
<li>A la pestanya Acceptance Transform Rules, fer click sobre el botó Add Rule.</li>
<li>A la plana Select Rule Template, seleccionar Send Claims Using a Custom Rule, i llavors fer click sobre el botó Next.</li>
<li>A la plana Configure Rule, en la capta Claim rule name, escriure “Transform NIF to Name”.</li>

<li><p>A la finestra Custom Rule, escriure o copiar/enganxar el següent text:</p>

<p>c:[Type == &ldquo;urn:oid:1.3.6.1.4.1.5923.1.1.1.6&rdquo;]
=&gt; issue(Type = &ldquo;<a href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name&quot;">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name&quot;</a>, Issuer = c.Issuer, OriginalIssuer = c.OriginalIssuer, Value = c.Value, ValueType = c.ValueType);</p></li>

<li><p>Fer click sobre Finish, i finalment sobre OK.</p></li>
</ul>

<p><strong>Configurar Sharepoint com a Relying Party</strong></p>

<p>Dintre de ADFS cal configurar Sharepoint com un “relying party” dels atributs proporcionats per ADFS.</p>

<ul>
<li>Obrir la consola de gestió de. En el menú Start, fer click a Administrative Tools, i llavors fer click sobre AD FS 2.0 Management.</li>
<li>Després que l’snap-in s’ha carregat, fer click sobre el node Trust Relationships, i llavors seleccionar Relying Party Trusts.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs1.png" alt="Integració amb GICAR" /></p>

<ul>
<li>Fer click amb el botó dret sobre Relying Party Trusts i llavors fer click sobre Add Relying Party Trust per iniciar el “Relying Party trust wizard”.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs2.png" alt="Integració amb GICAR" /></p>

<ul>
<li>Fer click sobre el botó Start per iniciar el procés d’afegir una aplicació web Sharepoint 2010 com a Relying Party.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs3.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la plana Select Data Source, seleccionar Enter data about the Relying party manually, i fer click sobre el botó Next.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs4.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la plana Specify Display Name, introduir el nom per mostrar, per exemple “SharePoint” i opcionalment una descripció, llavors fer click sobre Next.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs5.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la plana Choose Profile seleccionar AD FS 2.0 profile i fer click sobre Next.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs6.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la plana Configure Certificate, es pot seleccionar un certificat per xifrar el token intercanviat entre ADFS i Sharepoint però no es necessari ja que la connexió amb Sharepoint ja es fa sobre SSL.  Fer click sobre Next.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs7.png" alt="Integració amb GICAR" /></p>

<ul>
<li>Marcar el checkbox  Enable support for the WS-Fed Passive protocol.  Per la URL del protocol, introduir la URL del site root per a la aplicació web Sharepoint amb la terminació “_trust/”. Fer click  a Next.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs8.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la plana Configure Identifiers, s’indica un “realm” que l’aplicació web passarà a ADFS 2.0 quan un usuari accedeix a l’aplicació.<br />
El  “realm” normalement es crea en el format urn:foo:bar.  Cal tenir en compte aquest nom ja que es necessitarà en configurar Sharepoint Fer click sobre Next.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs9.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la plana Choose Issuance Authorization Rules no cal fer res, fer click a Next.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs10.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la plana Ready to Add Trust, revisar la configuració i fer click a Next per continuar.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs11.png" alt="Integració amb GICAR" /></p>

<ul>
<li>Deixar marcat el checkbox Open the Edit Claim Rules dialog for this relying party trust when the wizard closes per continuar en el següent punt.</li>
</ul>

<p><strong>Configurar Claim Rules per a Sharepoint</strong></p>

<p>Com a continuació del pas anterior (o fent click amb el botó dret sobre el “Relying Party” amb nom “Sharepoint” i seleccionat “Edit Claim Rules”), es poden configurar les regles que transformen els atributs de ADFS en els atributs que necessita Sharepoint.</p>

<ul>
<li>Primer accedim a la pantalla d’edició de regles.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs12.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la pestanya Issuance Transform Rules, fer click al botó Add Rule.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs13.png" alt="Integració amb GICAR" /></p>

<ul>
<li>A la plana Select Rule Template, seleccionar Pass Through or Filter an Incoming Claim, i llavors fer click a Next.</li>
</ul>

<p><img src="/related/gicar/gicar-adfs14.png" alt="Integració amb GICAR" /></p>

<ul>
<li><p>A la plana Configuration Rule, introduir els següents valors:</p>

<p>Name                    Value
Claim rule name         “E-Mail Address Claim from Shibboleth”
Incoming claim type     E-Mail Address</p></li>

<li><p>Deixar seleccionada la opció Pass through all claim values i fer click a Finish.</p></li>

<li><p>Repetir el mateix procés a Issuance Transform Rules amb els següents valors:</p>

<p>Name                    Value
Claim rule name         “NIF Claim from Shibboleth”
Incoming claim type     Name</p></li>
</ul>

<h2 id="configuració-sharepoint">CONFIGURACIÓ SHAREPOINT</h2>

<p><strong>Creació de Trusted Identity Provider corresponent a ADFS</strong></p>

<p>El passos que es descriuen a continuació assignen ADFS com un proveïdor d’identitats de confiança per a Sharepoint, cal obrir la consola de gestió PowerShell per  SharePoint 2010 com a usuari administrador i realitzar les següents accions:</p>

<ul>
<li><p>Obtenir el certificat de firma de ADFS, a la màquina on està ADFS accedir a la consola de gestió de ADFS i visitar a l’arbre de navegació el node ADFS -&gt; Service -&gt; Certificates. Accedir al certificat de firma (Token-signing) i obtenir un copia que guardarem a la màquina de Sharepoint a “C:\share\adfs.cer”</p></li>

<li><p>Fer click a Start, All programs, Microsoft SharePoint 2010 Products and SharePoint Management Shell i executar a Windows PowerShell les següents instruccions:</p>

<p>$certPath = “c:\share\adfs.cer”
$cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2(&ldquo;$certPath&rdquo;)</p></li>

<li><p>Creació de una nova autoritat proveïdora arrel a Sharepoint executant la següent comanda:</p>

<p>New-SPTrustedRootAuthority -Name &ldquo;IDMGT ADFS Token Signing Trusted Root Authority&rdquo; -Certificate $cert</p></li>

<li><p>Creació de la vinculació amb els atributs que SharePoint 2010 farà servir (email i name que conté el NIF):</p>

<p>$map1 = New-SPClaimTypeMapping -IncomingClaimType &ldquo;<a href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;</a> -IncomingClaimTypeDisplayName &ldquo;EmailAddress&rdquo; –SameAsIncoming</p>

<p>$map2 = New-SPClaimTypeMapping -IncomingClaimType &ldquo;<a href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name&quot;">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name&quot;</a> -IncomingClaimTypeDisplayName &ldquo;Name&rdquo; –SameAsIncoming</p></li>

<li><p>Creació de la variable “realm” (única pel site), ha de coincidir amb la indicada a ADFS a l’apartat “Configurar Sharepoint com a Relying Party”.</p>

<p>$realm = &ldquo;urn:sharepoint:portal&rdquo;</p>

<p>$signinurl = “https://<adfs_domain>/adfs/ls”</p></li>

<li><p>Creació i configuració del nou SPTrustedIdentityTokenIssuer per a que SharePoint 2010 accepti assercions SAML (WS-Fed Passive only).</p>

<p>$ap = New-SPTrustedIdentityTokenIssuer -Name &ldquo;ADFSv2-sts.idmgt.demo&rdquo; -Description &ldquo;ADFSv2-sts.idmgt.demo&rdquo; -realm $realm -ImportTrustCertificate $cert -ClaimsMappings $map1,$map2 -SignInUrl $signinurl -IdentifierClaim $map1.InputClaimType</p></li>

<li><p>Revisar el  SPTrustedIdentityTokenIssuer amb la següent instrucció:</p>

<p>Get-SPTrustedIdentityTokenIssuer –Identity &ldquo;ADFSv2-sts.idmgt.demo&rdquo;</p></li>

<li><p>Tancar la consola de comandes.</p></li>
</ul>

<p><strong>Declaració del Trusted Identity Provider per a la aplicació web</strong></p>

<p>Per associar ADFS (Trusted Identity Provider) a la aplicació web cal seguir els següents pasos:</p>

<ul>
<li><p>Fer click a Start, All programs, Microsoft SharePoint Products and SharePoint Central Administration.</p></li>

<li><p>Sota Application Management, fer click sobre l’enllaç Manage Web Applications.</p></li>

<li><p>Seleccionar a la llista l’aplicació web que farà servir AD FS 2.0 per i fer click a  Authentication Providers en el menu principal.</p></li>

<li><p>A la plana Authentication Provider, fer click a l’enllaç en el quadre de que correspon a la zona apropiada en que es farà servir per autenticar. Probablement Default Zone si no hi cap altre configurada amb aquest propòsit.</p></li>

<li><p>A la plana Edit Authentication, baixar fins la secció Claims Authentication Types.</p></li>
</ul>

<p><img src="/related/gicar/gicar-adfs15.png" alt="Integració amb GICAR" /></p>

<ul>
<li>Seleccionar Trusted Identity Provider i llavors “ADFSv2-sts.idmgt.demo” a la llista.</li>
<li>Fer click a Save</li>
<li>Tancar  SharePoint Central Administration.</li>
</ul>


					

					
				</div>	

			</article>	


	</section>	

		<div class="fons_footer ">
		<footer class="container center-block shadowBox2">
			<div class="shadow2"></div>
			<div class="row footer_tab_ord">

				<div class="footer_tab_bot col-sm-12">
					<div class="avis_legal">

						<div id="fAvisLegal">
							<div>
								<div class="hidden-xs">
									<a href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" alt="www.gencat.cat"
										/></a>
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								<div class="visible-xs avis_legal">
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								
								<div class="fi_peu visible-xs">
									<a title="www.gencat.cat" href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" 
										alt="www.gencat.cat" /></a> <a class="torna_amunt pull-right"
										href=" javascript:tornarAmunt();" title="Torna amunt">
										<p>Torna amunt</p>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

<script src="/js/master.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/custom.js" type="text/javascript"></script>



<script type="text/javascript">

if(location.hostname!=="localhost"){

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', "UA-59408075-1", 'auto');
	ga('send', 'pageview', {
	  	'page': location.pathname + location.search  + location.hash
	  }
	);

}

</script>




</body>
</html>
