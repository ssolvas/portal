<!DOCTYPE html>
<html xml:lang="ca-ES" lang="ca-ES" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<title>PSIS</title>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
	<link href="/css/master.min.css" rel="stylesheet" type="text/css" />
	<link href="/css/canigo.css" rel="stylesheet" type="text/css" />
	<script src="/js/jquery.min.js" type="text/javascript"></script>

	<script>
		document.write("<meta name=\"titol\" content=\"PSIS\" />");
		document.write("<meta name=\"description\" content=\"Validació de Signatures electròniques mitjançant els serveis de PSIS oferts per CatCert.\" />");
	</script>

	

</head>
<body class="single">
	<div class="contenidor unfixed">

				

		<header class="fons_header navbar navbar-default z-index-menu">
			<div class="container" role="menu">
				<div class="row clearfix menuNav">
					<div class="col-md-3 col-xs-3 column visible-xs coloca ">
						<button type="button" onclick="amunt();" title="Menu"
							class="navbar-toggle pull-left" data-toggle="collapse"
							data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
					</div>

					<div class="col-md-3 col-xs-6 col-offset-2 column visible-xs titol-mobil">
						
						<span class="white titol-mobil-destacat">canigo.ctti</span><span class="white">.gencat.cat</span>
					</div>

					<div class="col-md-3 col-xs-3 column visible-xs coloca1">
						<button onclick="amunt();" type="button" title="Cerca"
							class="ico_cerca " data-toggle="collapse" data-target=".dos">
						</button>
					</div>

				</div>

				<div class="collapse dos">
					<div class="shadowBox">
						<form class="navbar-form navbar-left primer" action="/cercador/" method="get"
 						onsubmit="location.href=this.action+'?q='+this.cerca_cap.value; return false;">
							<div class="form-group">
								<input type="search" class="form-control" name="q" id="cerca_cap"
									title="Cerca"
									placeholder="Cerca" />
								<button type="button" title="Neteja" class="btn btn-default"></button>
								<input type="submit" class="ocult" name="Cerca" value="Cerca" />
							</div>
						</form>
					</div>
				</div>	

				<nav class="collapse navbar-collapse navbar-ex1-collapse ">
				
					<div class="row">
						<div class="col-md-6 col-sm-4 column">
							<a class="img-responsive logo" title="Generalitat de Catalunya"
								href="https://ctti.gencat.cat/">gencat.cat</a>
							<button class="menu_tancar visible-xs collapsed"
								data-target=".navbar-collapse" data-toggle="collapse"
								title="Tancar"></button>
						</div>

						<div class="col-md-6 col-sm-8 column hidden-xs hidden-mg">
							<form class="navbar-form cercador_vermell hidden-xs pull-right" action="/cercador/"  method="get" onsubmit="location.href=this.action+'?q='+this.cerca2.value; return false;">
								<div class="form-group">
									<label class="hidden" for="cerca2">Cerca</label>
									<input id="cerca2" class="form-control" type="search" 
									placeholder="Cerca" name="q" title="Cerca">
									<input class="btn btn-default" type="submit" title="Cerca" value="">
								</div>
							</form>

							

						</div>

					</div>
					<div class="col-xs-12 hidden-xs" id="nomPortal">
                    	<span class="titol-cap-nou">Centre de Telecomunicacions i Tecnologies de la Informació</span>
                    </div>					
					<ul class="nav navbar-nav">

			        	

						<li>
							<a class="dropdown-toggle" href='/' data-toggle='_dropdown'>Inici</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/arqctti' data-toggle='_dropdown'>Arquitectura CTTI</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/blog' data-toggle='_dropdown'>Blog</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cloud' data-toggle='_dropdown'>Cloud</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/canigo' data-toggle='_dropdown'>Canigó</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sic' data-toggle='_dropdown'>SIC</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sgde' data-toggle='_dropdown'>SGDE</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/gicar' data-toggle='_dropdown'>GICAR</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cs' data-toggle='_dropdown'>Centres de Suport</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/dadesref' data-toggle='_dropdown'>Gestió Tècnica de Dades</a>
						</li>

						

					</ul>

				</nav>
			</div>
		</header>



	</div>

	<section class="border-start">

						
			

			<article class="bgGrey">
				<div class="container">
					<div class="row">
						<div class="capcelera_basica col-sm-12">
							<div class="capcelera_basica_cont">
								<ol class="breadcrumb filariana hidden-xs">
									<li>
										<a href="/">Inici</a>
									</li>
									<li class="breadcrumbs2">
									
										<a href="/canigo-documentacio-versions-34-integracio">
											




























										</a>
										


















	<a href="/canigo/">Framework Canigó</a> </li>
	<li>
		<a href="/canigo-documentacio/">Documentació</a>
	</li>

	<li>
		<a href="/canigo-documentacio-versions/">Versions</a>
	</li>

	<li>
		<a href="/canigo-documentacio-versions-34">Versió 3.4</a>
	</li>

	<li>
		
			<a href="/canigo-documentacio-versions-34-integracio">Mòduls d'Integració</a>
		












































































									
									</li>

								</ol>

								<h1 class="capcelera_flotant pull-left" data-txt=".title">
									

										
											




	PSIS


										

									
								</h1>

								

								
								

								

								

							</div>
						</div>

					</div>
				</div>
			</article>

			


		   <div class="padding-xs container">
	    	
	    	   <i><b>Darrera actualització:</b></i> 05-03-2015
	        
           </div>
           
			<article class="padding-xs padding-sm padding-md contingut">				
				<div class="container">
 		
					
				

	


					

						

<h2 id="propòsit">Propòsit</h2>

<p>Aquest mòdul permet la validació de Signatures electròniques mitjançant els serveis de PSIS oferts per CatCert.</p>

<h2 id="instal-lació-i-configuració">Instal.lació i Configuració</h2>

<h3 id="instal-lació">Instal.lació</h3>

<p>Per tal d&rsquo;instal- lar el mòdul de PSIS es pot incloure automàticament a través de l&rsquo;eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l&rsquo;aplicació la següent dependència:</p>

<pre><code class="language-xml">&lt;canigo.integration.psis.version&gt;[1.2.0,1.3.0)&lt;/canigo.integration.psis.version&gt;

&lt;dependency&gt;
          &lt;groupId&gt;cat.gencat.ctti&lt;/groupId&gt;
          &lt;artifactId&gt;canigo.integration.psis&lt;/artifactId&gt;
          &lt;version&gt;${canigo.integration.psis.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h3 id="configuració">Configuració</h3>

<p>La configuració es realitza automàticament a partir de la eina de suport al desenvolupament.</p>

<p>Ubicació: <PROJECT_ROOT>/src/main/resources/config/props/psis.properties</p>

<table>
<thead>
<tr>
<th>Propietat</th>
<th>Requerit</th>
<th>Descripció</th>
</tr>
</thead>

<tbody>
<tr>
<td>*.psis.urlPica</td>
<td>Sí</td>
<td>Url del WebService de PSIS. Valor per defecte: <a href="http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/">http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/</a></td>
</tr>

<tr>
<td>*.psis.finalitat</td>
<td>Sí</td>
<td>Finalitat de l&rsquo;accés al servei.</td>
</tr>

<tr>
<td>*.psis.nifEmisor</td>
<td>Sí</td>
<td>Nif de l&rsquo;emisor</td>
</tr>

<tr>
<td>*.psis.nomEmisor</td>
<td>Sí</td>
<td>Nom de l&rsquo;emisor</td>
</tr>

<tr>
<td>*.psis.nomFuncionari</td>
<td>Sí</td>
<td>Nom del funcionari</td>
</tr>

<tr>
<td>*.psis.nifFuncionari</td>
<td>Sí</td>
<td>Nif del funcionari</td>
</tr>

<tr>
<td>*.psis.emailFuncionari</td>
<td>Sí</td>
<td>Email del funcionari</td>
</tr>
</tbody>
</table>

<p>Els valors de finalitat, urlPica, nifEmisor i nomEmisor s&rsquo;han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat</p>

<p>Aquest mòdul és dependent del <a href="/canigo-documentacio-versions-34-integracio/modul-pica/">mòdul de la PICA</a> amb lo qual també s&rsquo;ha de configurar aquest.</p>

<h2 id="utilització-del-mòdul">Utilització del Mòdul</h2>

<h3 id="picaservice">PicaService</h3>

<p>El mòdul PSIS requereix de la creació del Bean del servei de la pica, per defecte Psis cerca un bean anomenat picaService. Si es dessitja canviar aquest nom es pot fer afegint al fitxer psis.propierties la següent propietat:</p>

<pre><code>psis.picaServiceBeanName=[nom del bean]
</code></pre>

<p>Un exemple del bean que s&rsquo;ha de crear:</p>

<pre><code>&lt;!-- BEAN DE LA PICA --&gt;
&lt;bean id=&quot;picaService&quot; parent=&quot;abstractPicaService&quot;&gt;
    &lt;property name=&quot;modalitats&quot;&gt;
        &lt;map&gt;
        &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>

<h3 id="rest">REST</h3>

<p>Per a utilitzar aquest mòdul, cal crear un Controller i un Service:</p>

<p><strong>PsisService.java</strong></p>

<p>Classe Java on es realitzarà la lògica de la operació a realitzar.</p>

<p>En aquest exemple es valida la caducitat d&rsquo;un certificat amb PSIS:</p>

<pre><code class="language-java">import java.io.InputStream;

import org.apache.commons.io.IOUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Service;

import cat.gencat.ctti.canigo.arch.integration.psis.PSISConnector;
import cat.gencat.ctti.canigo.arch.integration.psis.exceptions.PSISException;
import net.gencat.pica.psis.schemes.valCertSimpPICARequest.ValCertSimpPICARequestDocument;
import net.gencat.pica.psis.schemes.valCertSimpPICARequest.ValCertSimpPICARequestDocument.ValCertSimpPICARequest;
import net.gencat.pica.psis.schemes.valCertSimpPICAResponse.ValCertSimpPICAResponseDocument;

@Service(&quot;psisService&quot;)
@Lazy
public class PsisService {
    
    /** Logger  */  
    private static final Logger logger = LoggerFactory.getLogger(PsisService.class);

    @Autowired
    private PSISConnector psisServices;
    
    private static byte[] certificatCaducat = getBytesFromInputStream(Thread.currentThread().getContextClassLoader().getResourceAsStream(&quot;config/cert/certificatCaducat.crt&quot;));


     private static byte[] getBytesFromInputStream(InputStream is) {
         byte[] resultat = null;
         try {
             resultat = IOUtils.toByteArray(is);
         } catch (Exception e) {
             logger.error(e.getMessage(),e);
         }
         return resultat;
     }
     
     public String testValidarCertificatCaducat() {
         logger.debug(&quot;[testValidarCertificatCaducat]&quot;);
         
         String message;
         try{
             ValCertSimpPICARequestDocument document = ValCertSimpPICARequestDocument.Factory.newInstance();
             ValCertSimpPICARequest peticioValidar = ValCertSimpPICARequest.Factory.newInstance();
             peticioValidar.setCertificat(certificatCaducat);
             document.setValCertSimpPICARequest(peticioValidar);
             ValCertSimpPICAResponseDocument resposta = psisServices.validarCertificat(document);
             if (resposta!=null &amp;&amp; resposta.getValCertSimpPICAResponse()!=null &amp;&amp; resposta.getValCertSimpPICAResponse().getResultat()!=null){
                 message = &quot;S'ha verificat la caducitat del certificat amb el següent resultat: &quot;+ resposta.getValCertSimpPICAResponse().getResultat();
             }else{
                 message = &quot;No s'ha rebut resposta del servei o el format d'aquesta no es l'esperat&quot;;
             }
         } catch (PSISException e) {
             message = &quot;S'ha produït un error al servei&quot;;
             logger.error(e.getMessage(), e);
         } catch (Exception e) {
             message = &quot;S'ha produït un error general&quot;;
             logger.error(e.getMessage(), e);
         }
         
         return message;
     }
     
}
</code></pre>

<p><strong>PsisServiceController.java</strong><br />
Controller que publica les operacions disponibles per a qui hagi de consumir-les</p>

<pre><code class="language-java">import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import cat.gencat.plantilla32.service.PsisService;

@RestController
@RequestMapping(&quot;/psis&quot;)
public class PsisServiceController {

    @Autowired
    PsisService psisService;

    @GetMapping(produces = { MediaType.APPLICATION_JSON_VALUE })
    public String testValidarCertificatCaducat() {
        
        String message = psisService.testValidarCertificatCaducat();
        
        return message;
    }
}
</code></pre>


					

					
				</div>	

			</article>	


	</section>	

		<div class="fons_footer ">
		<footer class="container center-block shadowBox2">
			<div class="shadow2"></div>
			<div class="row footer_tab_ord">

				<div class="footer_tab_bot col-sm-12">
					<div class="avis_legal">

						<div id="fAvisLegal">
							<div>
								<div class="hidden-xs">
									<a href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" alt="www.gencat.cat"
										/></a>
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								<div class="visible-xs avis_legal">
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								
								<div class="fi_peu visible-xs">
									<a title="www.gencat.cat" href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" 
										alt="www.gencat.cat" /></a> <a class="torna_amunt pull-right"
										href=" javascript:tornarAmunt();" title="Torna amunt">
										<p>Torna amunt</p>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

<script src="/js/master.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/custom.js" type="text/javascript"></script>



<script type="text/javascript">

if(location.hostname!=="localhost"){

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', "UA-59408075-1", 'auto');
	ga('send', 'pageview', {
	  	'page': location.pathname + location.search  + location.hash
	  }
	);

}

</script>




</body>
</html>
