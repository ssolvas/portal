<!DOCTYPE html>
<html xml:lang="ca-ES" lang="ca-ES" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<title>Mòdul RS</title>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
	<link href="/css/master.min.css" rel="stylesheet" type="text/css" />
	<link href="/css/canigo.css" rel="stylesheet" type="text/css" />
	<script src="/js/jquery.min.js" type="text/javascript"></script>

	<script>
		document.write("<meta name=\"titol\" content=\"Mòdul RS\" />");
		document.write("<meta name=\"description\" content=\"Mòdul RESTful Services\" />");
	</script>

	

</head>
<body class="single">
	<div class="contenidor unfixed">

				

		<header class="fons_header navbar navbar-default z-index-menu">
			<div class="container" role="menu">
				<div class="row clearfix menuNav">
					<div class="col-md-3 col-xs-3 column visible-xs coloca ">
						<button type="button" onclick="amunt();" title="Menu"
							class="navbar-toggle pull-left" data-toggle="collapse"
							data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
					</div>

					<div class="col-md-3 col-xs-6 col-offset-2 column visible-xs titol-mobil">
						
						<span class="white titol-mobil-destacat">canigo.ctti</span><span class="white">.gencat.cat</span>
					</div>

					<div class="col-md-3 col-xs-3 column visible-xs coloca1">
						<button onclick="amunt();" type="button" title="Cerca"
							class="ico_cerca " data-toggle="collapse" data-target=".dos">
						</button>
					</div>

				</div>

				<div class="collapse dos">
					<div class="shadowBox">
						<form class="navbar-form navbar-left primer" action="/cercador/" method="get"
 						onsubmit="location.href=this.action+'?q='+this.cerca_cap.value; return false;">
							<div class="form-group">
								<input type="search" class="form-control" name="q" id="cerca_cap"
									title="Cerca"
									placeholder="Cerca" />
								<button type="button" title="Neteja" class="btn btn-default"></button>
								<input type="submit" class="ocult" name="Cerca" value="Cerca" />
							</div>
						</form>
					</div>
				</div>	

				<nav class="collapse navbar-collapse navbar-ex1-collapse ">
				
					<div class="row">
						<div class="col-md-6 col-sm-4 column">
							<a class="img-responsive logo" title="Generalitat de Catalunya"
								href="https://ctti.gencat.cat/">gencat.cat</a>
							<button class="menu_tancar visible-xs collapsed"
								data-target=".navbar-collapse" data-toggle="collapse"
								title="Tancar"></button>
						</div>

						<div class="col-md-6 col-sm-8 column hidden-xs hidden-mg">
							<form class="navbar-form cercador_vermell hidden-xs pull-right" action="/cercador/"  method="get" onsubmit="location.href=this.action+'?q='+this.cerca2.value; return false;">
								<div class="form-group">
									<label class="hidden" for="cerca2">Cerca</label>
									<input id="cerca2" class="form-control" type="search" 
									placeholder="Cerca" name="q" title="Cerca">
									<input class="btn btn-default" type="submit" title="Cerca" value="">
								</div>
							</form>

							

						</div>

					</div>
					<div class="col-xs-12 hidden-xs" id="nomPortal">
                    	<span class="titol-cap-nou">Centre de Telecomunicacions i Tecnologies de la Informació</span>
                    </div>					
					<ul class="nav navbar-nav">

			        	

						<li>
							<a class="dropdown-toggle" href='/' data-toggle='_dropdown'>Inici</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/arqctti' data-toggle='_dropdown'>Arquitectura CTTI</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/blog' data-toggle='_dropdown'>Blog</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cloud' data-toggle='_dropdown'>Cloud</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/canigo' data-toggle='_dropdown'>Canigó</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sic' data-toggle='_dropdown'>SIC</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/sgde' data-toggle='_dropdown'>SGDE</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/gicar' data-toggle='_dropdown'>GICAR</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/cs' data-toggle='_dropdown'>Centres de Suport</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/dadesref' data-toggle='_dropdown'>Gestió Tècnica de Dades</a>
						</li>

						

						<li>
							<a class="dropdown-toggle" href='/eventhub' data-toggle='_dropdown'>EventHub</a>
						</li>

						

					</ul>

				</nav>
			</div>
		</header>



	</div>

	<section class="border-start">

						
			

			<article class="bgGrey">
				<div class="container">
					<div class="row">
						<div class="capcelera_basica col-sm-12">
							<div class="capcelera_basica_cont">
								<ol class="breadcrumb filariana hidden-xs">
									<li>
										<a href="/">Inici</a>
									</li>
									<li class="breadcrumbs2">
									
										<a href="/canigo-fwk-docs">
											




























	
	
	
	
	
	  
	  
	
	  
	  
	  	
	  	
	  	<a href='https://canigo.ctti.gencat.cat/canigo-fwk-docs/'>canigo fwk docs</a>
	  	
	  
	
	  
	  
	  	
	  	
	  		<li>
	  	
	  	<a href='https://canigo.ctti.gencat.cat/canigo-fwk-docs/documentacio-per-versions/'>documentacio per versions</a>
	  	
	  		</li>
	  	
	  
	
	  
	  
	  	
	  	
	  		<li>
	  	
	  	<a href='https://canigo.ctti.gencat.cat/canigo-fwk-docs/documentacio-per-versions/3.4LTS/'>3.4LTS</a>
	  	
	  		</li>
	  	
	  
	
	  
	  
	  	
	  	
	  		<li>
	  	
	  	<a href='https://canigo.ctti.gencat.cat/canigo-fwk-docs/documentacio-per-versions/3.4LTS/3.4.8/'>3.4.8</a>
	  	
	  		</li>
	  	
	  
	
	  
	  
	  	
	  	
	  		<li>
	  	
	  	<a href='https://canigo.ctti.gencat.cat/canigo-fwk-docs/documentacio-per-versions/3.4LTS/3.4.8/moduls/'>moduls</a>
	  	
	  		</li>
	  	
	  
	
	  
	  
	  	
	  	
	  		<li>
	  	
	  	<a href='https://canigo.ctti.gencat.cat/canigo-fwk-docs/documentacio-per-versions/3.4LTS/3.4.8/moduls/moduls-generals/'>moduls generals</a>
	  	
	  		</li>
	  	
	  
	
	  
	  
	  	
	  	
	  		<li>
	  	
	  	<a href='https://canigo.ctti.gencat.cat/canigo-fwk-docs/documentacio-per-versions/3.4LTS/3.4.8/moduls/moduls-generals/modul-rs/'>modul rs</a>
	  	
	  		</li>
	  	
	  
	
	  
	  
	


										</a>
										




























































































									
									</li>

								</ol>

								<h1 class="capcelera_flotant pull-left" data-txt=".title">
									

										
											




	Mòdul RS


										

									
								</h1>

								

								
								

								

								

							</div>
						</div>

					</div>
				</div>
			</article>

			


		   <div class="padding-xs container">
	    	
	    	   <i><b>Darrera actualització:</b></i> 17-12-2021
	        
           </div>
           
			<article class="padding-xs padding-sm padding-md contingut">				
				<div class="container">
 		
					
				

	


					

						

<h2 id="propòsit">Propòsit</h2>

<p>Aquest mòdul proporciona eines per a l&rsquo;exposició de serveis REST. Està basat en les millors pràctiques descrites a <a href="http://canigo.ctti.gencat.cat/blog/2016/01/api/">Canigó APIs RESTful</a></p>

<p>Entre altres característiques, destaquem les següents:</p>

<ul>
<li>Control genèric d&rsquo;errors</li>
<li>Classes estàndard de resposta</li>
<li>Controladors per exposar les propietats de configuració de l&rsquo;aplicació i mòduls carregats</li>
</ul>

<p>Tot el contingut es serveix en format JSON.</p>

<h2 id="instal-lació-i-configuració">Instal·lació i Configuració</h2>

<h3 id="instal-lació">Instal·lació</h3>

<p>El mòdul RS i el corresponent test unitari s&rsquo;inclou per defecte dins del core de Canigó 3.
Durant el procés de creació de l&rsquo;aplicació, l&rsquo;eina de suport al desenvolupament inclourà la referència dins del pom.xml.
En cas d&rsquo;una instal- lació manual afegir les següents línies al pom.xml de l&rsquo;aplicació:</p>

<pre><code>&lt;canigo.web.rs.version&gt;[1.1.0,1.2.0)&lt;/canigo.web.rs.version&gt;
&lt;canigo.test.version&gt;[1.2.0,1.3.0)&lt;/canigo.test.version&gt;

&lt;dependency&gt;
 &lt;groupId&gt;cat.gencat.ctti&lt;/groupId&gt;
 &lt;artifactId&gt;canigo.web.rs&lt;/artifactId&gt;
 &lt;version&gt;${canigo.web.rs.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;cat.gencat.ctti&lt;/groupId&gt;
    &lt;artifactId&gt;canigo.test&lt;/artifactId&gt;
    &lt;version&gt;${canigo.test.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
   &lt;groupId&gt;cat.gencat.ctti&lt;/groupId&gt;
   &lt;artifactId&gt;canigo.web.rs&lt;/artifactId&gt;
   &lt;type&gt;test-jar&lt;/type&gt;
   &lt;version&gt;${canigo.web.rs.version}&lt;/version&gt;
   &lt;scope&gt;test&lt;/scope&gt;
   &lt;classifier&gt;tests&lt;/classifier&gt;
&lt;/dependency&gt;
</code></pre>

<p>Al pom.xml també s&rsquo;ha d&rsquo;afegir el plugin que executa el test unitari del mòdul RS:</p>

<pre><code>&lt;build&gt;
    ...
    &lt;plugins&gt;
        ...
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
            &lt;executions&gt;
                &lt;execution&gt;
                    &lt;id&gt;base-test&lt;/id&gt;
                    &lt;phase&gt;test&lt;/phase&gt;
                    &lt;goals&gt;
                        &lt;goal&gt;test&lt;/goal&gt;
                    &lt;/goals&gt;
                    &lt;configuration&gt;
                        &lt;dependenciesToScan&gt;
                            &lt;dependency&gt;cat.gencat.ctti:canigo.web.rs&lt;/dependency&gt;
                            ...
                        &lt;/dependenciesToScan&gt;
            &lt;excludes&gt;
                            &lt;exclude&gt;%regex[${project.groupId}.*.*Test.*]&lt;/exclude&gt;
            &lt;/excludes&gt;
                    &lt;/configuration&gt;
                &lt;/execution&gt;
                ...
            &lt;/executions&gt;
        &lt;/plugin&gt;
        ...
    &lt;/plugins&gt;
    ...
&lt;/build&gt;    
</code></pre>

<h3 id="configuració">Configuració</h3>

<p>No necessita cap configuració especial.</p>

<h3 id="ús-de-controladors-rest-controllers">Ús de controladors (REST Controllers)</h3>

<p>Hi ha dos controladors inclosos dins el mòdul:</p>

<pre><code>    1. _InfoModulesController_: retorna la llista de mòduls Canigó carregats a l'aplicació i les seves corresponents versions. La seva URL és http://&lt;app&gt;/info/modules
    2. _InfoPropertiesController_: retorna la llista de propietats definides a l'aplicació i els seus valors. La seva URL és http://&lt;app&gt;/info/properties
</code></pre>

<p>Per seguretat aquests controladors per defecte no es troben disponibles.</p>

<p>Per a que es publiquin a l&rsquo;aplicació s&rsquo;ha de realitzar la següent configuració:</p>

<p>Al fitxer de configuració de l’aplicació (AppConfig.java) afegir l’annotació @PropertySource al fitxer boot.properties que s’ha de crear:</p>

<pre><code>@Configuration
@PropertySource(&quot;classpath:/config/props/boot.properties&quot;)
@ImportResource({ &quot;classpath:cat/gencat/ctti/canigo/arch/core/config/canigo-core.xml&quot; })
@EnableTransactionManagement
public class AppConfig {
}
</code></pre>

<p>Crear el fitxer /src/main/reources/config/props/boot.properties amb les següents propietats a true:</p>

<pre><code>publishInfoModules=true
publishInfoProperties=true
</code></pre>

<p><span style="color:red">En entorns productius aquests endpoints s&rsquo;han de protegir o bloquejar</style></p>

<h4 id="donar-d-alta-un-nou-controlador">Donar d&rsquo;alta un nou controlador</h4>

<p>Per donar d&rsquo;alta un nou controlador a l&rsquo;aplicació Canigó s&rsquo;ha de seguir la <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html">documentació de referència de Spring MVC</a></p>

<p>Exemple de definició d&rsquo;un controlador:</p>

<pre><code>package cat.gencat.ctti.canigo.arch.web.rs.controller;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping(&quot;/hello&quot;)
public class HelloController {

    @GetMapping(produces = MediaType.APPLICATION_JSON_VALUE)
    public String getHello() {
        return &quot;hello!&quot;;
    }

}
</code></pre>

<h3 id="gestió-d-errors-per-defecte">Gestió d&rsquo;errors per defecte</h3>

<p>Una de les funcionalitats que incorpora el Mòdul RS és la de gestió d&rsquo;errors per defecte. S&rsquo;ha definit un @RestControllerAdvice que intercepta les excepcions dels tipus:</p>

<pre><code>    - MultipartException
    - AuthenticationException
    - AccessDeniedException
    - ResourceNotFoundException
    - Exception
    
</code></pre>

<p>Quan es produeix aquestes excepcions a l&rsquo;aplicació, són capturades pel @RestControllerAdvice i retornades en format JSON al client. El client rep un JSON amb el codi i missatge de l&rsquo;excepció en el cos de la resposta, i en format JSON o JSONP si s&rsquo;ha fet la crida amb una funció de retorn.
Es pot personalitzar i &ldquo;localitzar&rdquo; (i18n) el missatge que s&rsquo;envia al client per cadascuna de les excepcions. Això és possible fer-ho definint les següents propietats en els fitxers de recursos carregats a l&rsquo;aplicació:</p>

<pre><code>    - canigo.web.rs.resource.notfoud.msg --&gt; Per a les excepcions de tipus ResourceNotFoundException
    - canigo.web.rs.unauthorized.msg  --&gt; Per a les excepcions de tipus AuthenticationException i AccessDeniedException
    - canigo.web.rs.multipart.bad.request.msg --&gt; Per a les excepcions de tipus MultipartException
    - Per a la resta d'excepcions que estenguin del tipus Exception s'utilitza el localizedMessage de la mateixa excepció. Per tant, és necessari sobreescriure el mètode getLocalizedMessage amb la propietat el valor de la qual es vol enviar com a missatge al client. Un exemple seria el següent:

    public class CustomException extends Exception {

        private static final long serialVersionUID = -3973341495451225082L;
    
        @Override
        public String getLocalizedMessage() {
            return &quot;custom.message&quot;;
        }

    }
    
    
</code></pre>

<p>Es poden definir tants RestControllerAdvice com es necessiti.</p>

<h3 id="objectes-de-suport">Objectes de suport</h3>

<p>Amb la finalitat d&rsquo;estandaritzar i facilitar la feina als desenvolupadors, es posa a la seva disposició objectes estàndard de petició i resposta.</p>

<h4 id="request">Request</h4>

<p>S&rsquo;han definit els següents objectes de petició, tenint en compte les bones pràctiques definides a <a href="http://canigo.ctti.gencat.cat/blog/2016/01/api/">Canigó APIs RESTful</a>:</p>

<pre><code>    - BatchRequest --&gt; Per a peticions batch

</code></pre>

<h4 id="response">Response</h4>

<p>S&rsquo;han definit els següents objectes de resposta, tenint en compte les bones pràctiques definides a <a href="http://canigo.ctti.gencat.cat/blog/2016/01/api/">Canigó APIs RESTful</a>:</p>

<pre><code>    - ResponseBatch --&gt; Per a peticions batch
    - ResponseError --&gt; Per errors
    - ResponsePage  --&gt; Per documents paginats
    
</code></pre>


					

					
				</div>	

			</article>	


	</section>	

		<div class="fons_footer ">
		<footer class="container center-block shadowBox2">
			<div class="shadow2"></div>
			<div class="row footer_tab_ord">

				<div class="footer_tab_bot col-sm-12">
					<div class="avis_legal">

						<div id="fAvisLegal">
							<div>
								<div class="hidden-xs">
									<a href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" alt="www.gencat.cat"
										/></a>
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								<div class="visible-xs avis_legal">
									<p>
										<a title="Avis legal" href="https://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								
								<div class="fi_peu visible-xs">
									<a title="www.gencat.cat" href="https://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" 
										alt="www.gencat.cat" /></a> <a class="torna_amunt pull-right"
										href=" javascript:tornarAmunt();" title="Torna amunt">
										<p>Torna amunt</p>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

<script src="/js/master.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/custom.js" type="text/javascript"></script>



<script type="text/javascript">

if(location.hostname!=="localhost"){

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', "UA-59408075-1", 'auto');
	ga('send', 'pageview', {
	  	'page': location.pathname + location.search  + location.hash
	  }
	);

}

</script>




</body>
</html>
